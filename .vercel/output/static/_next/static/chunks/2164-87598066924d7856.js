try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2e01525f-840c-47e4-9254-7bdd4f2f4d95",e._sentryDebugIdIdentifier="sentry-dbid-2e01525f-840c-47e4-9254-7bdd4f2f4d95")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2164],{1473:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(71847).A)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]])},11010:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(71847).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},22963:(e,t,a)=>{a.d(t,{m:()=>x});var s=a(95155),r=a(12115),i=a(90235),n=a(23327),l=a(61464),c=a(25016);let d=l.Kq,o=l.bL,m=l.l9,p=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,c.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})});function x(e){let{value:t,onChange:a,disabled:l=!1,className:c=""}=e,[x,u]=r.useState([]),[h,g]=r.useState(!0),[y,v]=r.useState(null);r.useEffect(()=>{f()},[]);let f=async()=>{try{g(!0);let e=await fetch("/api/ai/prompt-templates");if(!e.ok)throw Error("Failed to fetch templates");let s=await e.json();u(s.templates||[]),!t&&s.templates.length>0&&a(s.templates[0].key)}catch(e){console.error("Error fetching templates:",e),v("Failed to load templates")}finally{g(!1)}},b=x.find(e=>e.key===t);return y?(0,s.jsx)("div",{className:"text-sm text-destructive",children:y}):h?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{children:"Story Generation Template"}),(0,s.jsx)("div",{className:"h-10 bg-muted animate-pulse rounded-md"})]}):(0,s.jsxs)("div",{className:"space-y-2 ".concat(c),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.J,{htmlFor:"prompt-template",children:"Story Generation Template"}),(0,s.jsx)(d,{children:(0,s.jsxs)(o,{children:[(0,s.jsx)(m,{asChild:!0,children:(0,s.jsx)(n.A,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),(0,s.jsx)(p,{className:"max-w-xs",children:(0,s.jsx)("p",{className:"text-sm",children:"Select a template to guide how user stories are generated. Each template uses a different approach and level of detail."})})]})})]}),(0,s.jsx)("select",{id:"prompt-template",value:t,onChange:e=>a(e.target.value),disabled:l,className:"flex h-10 w-full appearance-none rounded-lg border border-gray-700 bg-gray-800/50 px-3 py-2 text-sm text-white ring-offset-gray-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-purple-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all hover:border-gray-600",children:x.map(e=>(0,s.jsxs)("option",{value:e.key,children:[e.icon," ",e.displayName,e.requiresAdminTier?" (Admin)":""]},e.key))}),b&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:b.description})]})}p.displayName=l.UC.displayName},32559:(e,t,a)=>{a.d(t,{Fc:()=>c,TN:()=>o,XL:()=>d});var s=a(95155),r=a(12115),i=a(83101),n=a(25016);let l=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,...i}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:r}),a),...i})});c.displayName="Alert";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});d.displayName="AlertTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...r})});o.displayName="AlertDescription"},40515:(e,t,a)=>{a.d(t,{Kx:()=>r,Mh:()=>n,_E:()=>i,wL:()=>l,yT:()=>s});var s=function(e){return e.MINIMAL="minimal",e.STANDARD="standard",e.COMPREHENSIVE="comprehensive",e.COMPREHENSIVE_THINKING="comprehensive-thinking",e}({}),r=function(e){return e.STARTER="starter",e.CORE="core",e.PRO="pro",e.TEAM="team",e.ENTERPRISE="enterprise",e}({});let i={minimal:{level:"minimal",actionsRequired:1,tokenEstimate:2e3,features:["Basic story generation","INVEST rating"]},standard:{level:"standard",actionsRequired:2,tokenEstimate:3e3,features:["Project roles & terminology","Example stories for consistency","Common constraints"]},comprehensive:{level:"comprehensive",actionsRequired:2,tokenEstimate:4500,features:["All Standard features","Semantic search (top 5 similar stories)","Epic-level constraints","Dependency detection"]},"comprehensive-thinking":{level:"comprehensive-thinking",actionsRequired:3,tokenEstimate:6e3,features:["All Comprehensive features","Deep reasoning mode","Complex edge case analysis","Compliance & security focus"]}},n={starter:["minimal"],core:["minimal","standard"],pro:["minimal","standard","comprehensive"],team:["minimal","standard","comprehensive","comprehensive-thinking"],enterprise:["minimal","standard","comprehensive","comprehensive-thinking"]},l={starter:25,core:400,pro:800,team:15e3,enterprise:999999}},48371:(e,t,a)=>{a.d(t,{F:()=>C});var s=a(95155),r=a(12115),i=a(18720),n=a(2327),l=a(54679),c=a(97003),d=a(33789),o=a(67001),m=a(90235),p=a(47507),x=a(32559),u=a(95740),h=a(65229),g=a(6132),y=a(40515),v=a(62401),f=a(56154),b=a(1473),j=a(23327);let N=(0,a(71847).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function E(e){let{userTier:t,actionsUsed:a,monthlyLimit:i,selectedLevel:n,onLevelChange:l,epicId:c,projectId:d}=e,[o,m]=(0,r.useState)(!1),p=i-a,x=[{level:y.yT.MINIMAL,icon:f.A,label:"Minimal",badge:"Fastest",description:"Basic generation with no project context",actions:1,available:v.j.canAccessContextLevel(t,y.yT.MINIMAL)},{level:y.yT.STANDARD,icon:u.A,label:"Standard",badge:"Recommended",description:"Uses project roles, terminology, and example stories",actions:2,available:v.j.canAccessContextLevel(t,y.yT.STANDARD)},{level:y.yT.COMPREHENSIVE,icon:b.A,label:"Comprehensive",badge:"Best Quality",description:"Semantic search finds top 5 similar stories in epic",actions:2,available:v.j.canAccessContextLevel(t,y.yT.COMPREHENSIVE),requiresEpic:!0},{level:y.yT.COMPREHENSIVE_THINKING,icon:b.A,label:"Comprehensive + Thinking",badge:"Expert Mode",description:"Deep reasoning for complex compliance/security stories",actions:3,available:v.j.canAccessContextLevel(t,y.yT.COMPREHENSIVE_THINKING),requiresEpic:!0}];return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Context Level"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"More context = better accuracy, more AI actions"})]}),(0,s.jsxs)("button",{onClick:()=>m(!o),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[(0,s.jsx)(j.A,{className:"w-3 h-3"}),o?"Hide":"Show"," details"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"AI Actions Used"}),(0,s.jsxs)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[a.toLocaleString()," / ",i.toLocaleString()]})]}),(0,s.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 ".concat(a/i>.9?"bg-red-500":a/i>.7?"bg-yellow-500":"bg-blue-500"),style:{width:"".concat(Math.min(a/i*100,100),"%")}})}),p<10&&(0,s.jsxs)("p",{className:"text-xs text-red-600 dark:text-red-400",children:["⚠️ Low on actions! Only ",p," remaining this month."]})]}),(0,s.jsx)("div",{className:"space-y-2",children:x.map(e=>{let a=n===e.level,r=e.requiresEpic&&!c,i=!e.available,d=r||i,m=p>=e.actions;return(0,s.jsxs)("div",{className:"\n                relative border rounded-lg p-4 cursor-pointer transition-all\n                ".concat(a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600","\n                ").concat(d?"opacity-50 cursor-not-allowed":"","\n              "),onClick:()=>{!d&&m&&l(e.level)},children:[i&&(0,s.jsx)("div",{className:"absolute top-2 right-2",children:(0,s.jsx)(N,{className:"w-4 h-4 text-gray-400"})}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"\n                  p-2 rounded-lg \n                  ".concat(a?"bg-blue-100 dark:bg-blue-800":"bg-gray-100 dark:bg-gray-800","\n                "),children:(0,s.jsx)(e.icon,{className:"w-5 h-5 ".concat(a?"text-blue-600":"text-gray-600")})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:e.label}),(0,s.jsx)("span",{className:"\n                      text-xs px-2 py-0.5 rounded-full\n                      ".concat(a?"bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-200":"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400","\n                    "),children:e.badge})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[(0,s.jsxs)("span",{className:"font-medium ".concat(m?"text-gray-700 dark:text-gray-300":"text-red-600 dark:text-red-400"),children:[e.actions," ",1===e.actions?"action":"actions"]}),!m&&(0,s.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"Insufficient actions"})]}),o&&(0,s.jsx)("ul",{className:"mt-2 space-y-1",children:y._E[e.level].features.map((e,t)=>(0,s.jsxs)("li",{className:"text-xs text-gray-600 dark:text-gray-400 flex items-start gap-1",children:[(0,s.jsx)("span",{className:"text-blue-500 mt-0.5",children:"•"}),(0,s.jsx)("span",{children:e})]},t))}),r&&(0,s.jsx)("p",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400",children:"ℹ️ Requires story to be in an epic"}),i&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:v.j.getUpgradeMessage(t,e.level)}),(0,s.jsx)("a",{href:"/pricing",className:"text-xs font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400",children:"Upgrade Now →"})]})]}),!d&&(0,s.jsx)("div",{className:"\n                    w-4 h-4 rounded-full border-2 flex items-center justify-center\n                    ".concat(a?"border-blue-500 bg-blue-500":"border-gray-300 dark:border-gray-600","\n                  "),children:a&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]})]},e.level)})}),(0,s.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"This generation will use:"}),(0,s.jsxs)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[y._E[n].actionsRequired," AI ",1===y._E[n].actionsRequired?"action":"actions"]})]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("span",{children:"Estimated tokens:"}),(0,s.jsx)("span",{children:y._E[n].tokenEstimate.toLocaleString()})]})]})]})}var I=a(22963);function C(e){let{open:t,onOpenChange:a,projectId:v,story:f,onSuccess:b}=e,[j,N]=r.useState(!1),[C,w]=r.useState(!1),[k,T]=r.useState(null),[A,S]=r.useState([]),[R,M]=r.useState(!1),[P,L]=r.useState(""),[D,O]=r.useState(!1),[H,F]=r.useState("standard"),[q,_]=r.useState({title:"",description:"",priority:"medium",storyPoints:0,epicId:"",acceptanceCriteria:[""]}),[K,V]=r.useState(y.yT.STANDARD),G=r.useCallback(async()=>{try{let e=await n.F.epics.list({projectId:v,status:"published"});S(e.data||[])}catch(e){console.error("Failed to load epics:",e)}},[v]);r.useEffect(()=>{t&&v&&G()},[t,v,G]),r.useEffect(()=>{f&&_({title:f.title,description:f.description||"",priority:f.priority,storyPoints:f.storyPoints||0,epicId:f.epicId||"",acceptanceCriteria:f.acceptanceCriteria||[""]})},[f]);let U=async e=>(e.preventDefault(),q.title.trim())?q.epicId||!(A.length>0)||D?void await z():void O(!0):void T("Title is required"),z=async()=>{N(!0),T(null);try{if(f){let e={title:q.title.trim(),description:q.description.trim()||void 0,priority:q.priority,storyPoints:q.storyPoints||void 0,acceptanceCriteria:q.acceptanceCriteria.filter(e=>e.trim())};q.epicId&&q.epicId.trim()?e.epicId=q.epicId:""===q.epicId&&(e.epicId=null),await n.F.stories.update(f.id,e),i.o.success("Story updated successfully!")}else{let e={projectId:v,title:q.title.trim(),description:q.description.trim()||void 0,priority:q.priority,storyPoints:q.storyPoints||void 0,epicId:q.epicId&&q.epicId.trim()?q.epicId:void 0,acceptanceCriteria:q.acceptanceCriteria.filter(e=>e.trim())};await n.F.stories.create(e),i.o.success("Story created successfully!")}_({title:"",description:"",priority:"medium",storyPoints:0,epicId:"",acceptanceCriteria:[""]}),O(!1),null==b||b(),a(!1)}catch(e){T(e.message||"Failed to save story"),i.o.error(e.message||"Failed to save story")}finally{N(!1)}},J=async()=>{if(!P.trim())return void T("Please enter a requirement to generate a story");if(P.trim().length<10)return void T("Requirement must be at least 10 characters");w(!0),T(null);try{var e;let t=await fetch("/api/ai/generate-single-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requirement:P.trim(),projectId:v,epicId:q.epicId||void 0,contextLevel:K,promptTemplate:H})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to generate story")}let a=(await t.json()).story;_({title:a.title||"",description:a.description||"",priority:a.priority||"medium",storyPoints:a.storyPoints||0,epicId:q.epicId,acceptanceCriteria:(null==(e=a.acceptanceCriteria)?void 0:e.length)>0?a.acceptanceCriteria:[""]}),M(!1),L(""),i.o.success("Story generated successfully! Review and adjust as needed.")}catch(e){T(e.message||"Failed to generate story"),i.o.error(e.message||"Failed to generate story")}finally{w(!1)}};return(0,s.jsx)(l.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(l.Cf,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("form",{onSubmit:U,children:[(0,s.jsxs)(l.c7,{children:[(0,s.jsx)(l.L3,{children:f?"Edit Story":"Create New Story"}),(0,s.jsx)(l.rr,{children:f?"Update story details":"Add a new story to your project"})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[!f&&!R&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>M(!0),disabled:j,className:"gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"Generate with AI"]})}),!f&&R&&(0,s.jsxs)("div",{className:"grid gap-3 p-4 border border-purple-500/30 bg-purple-500/5 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(m.J,{className:"text-purple-400 flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"AI Story Generation"]}),(0,s.jsx)(c.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>{M(!1),L(""),T(null)},disabled:C,children:(0,s.jsx)(h.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(I.m,{value:H,onChange:F,disabled:C}),(0,s.jsx)(o.T,{placeholder:"Describe what you want this story to accomplish... (e.g., 'Allow users to reset their password via email')",value:P,onChange:e=>L(e.target.value),disabled:C,rows:3,maxLength:500}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:[P.length,"/500 characters"]}),(0,s.jsx)(c.$,{type:"button",onClick:J,disabled:C||P.trim().length<10,size:"sm",className:"gap-2",children:C?(0,s.jsx)(s.Fragment,{children:"Generating..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"Generate Story"]})})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{htmlFor:"title",children:"Title *"}),(0,s.jsx)(d.p,{id:"title",placeholder:"As a user, I want to...",value:q.title,onChange:e=>_(t=>({...t,title:e.target.value})),maxLength:255,disabled:j,autoFocus:!0})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{htmlFor:"description",children:"Description"}),(0,s.jsx)(o.T,{id:"description",placeholder:"Describe the story in detail...",value:q.description,onChange:e=>_(t=>({...t,description:e.target.value})),maxLength:2e3,disabled:j,rows:3})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{htmlFor:"priority",children:"Priority"}),(0,s.jsxs)(p.l,{id:"priority",value:q.priority,onChange:e=>_(t=>({...t,priority:e.target.value})),disabled:j,children:[(0,s.jsx)("option",{value:"low",children:"Low"}),(0,s.jsx)("option",{value:"medium",children:"Medium"}),(0,s.jsx)("option",{value:"high",children:"High"}),(0,s.jsx)("option",{value:"critical",children:"Critical"})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{htmlFor:"storyPoints",children:"Story Points"}),(0,s.jsx)(d.p,{id:"storyPoints",type:"number",min:"0",max:"100",value:q.storyPoints,onChange:e=>_(t=>({...t,storyPoints:parseInt(e.target.value)||0})),disabled:j})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{htmlFor:"epic",children:"Epic (optional)"}),(0,s.jsxs)("select",{id:"epic",value:q.epicId,onChange:e=>{_(t=>({...t,epicId:e.target.value})),O(!1)},disabled:j||0===A.length,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[(0,s.jsx)("option",{value:"",children:"No Epic"}),A.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]}),0===A.length&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"No epics available. Create an epic first to organize your stories."}),D&&A.length>0&&(0,s.jsxs)(x.Fc,{className:"border-amber-500/50 bg-amber-500/10 mt-2",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 text-amber-500"}),(0,s.jsxs)(x.TN,{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium mb-2",children:"This story is not associated with an epic."}),(0,s.jsx)("p",{className:"text-muted-foreground mb-3",children:"Associating stories with epics helps organize and track progress. Do you want to select an epic?"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;O(!1),null==(e=document.getElementById("epic"))||e.focus()},children:"Select Epic"}),(0,s.jsx)(c.$,{type:"button",variant:"default",size:"sm",onClick:()=>{O(!1),z()},children:"Continue Without Epic"})]})]})]})]}),!f&&R&&(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.J,{children:"AI Context Level"}),(0,s.jsx)(E,{selectedLevel:K,onLevelChange:V,userTier:y.Kx.PRO,actionsUsed:0,monthlyLimit:800,projectId:v,epicId:q.epicId||void 0})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(m.J,{children:"Acceptance Criteria"}),(0,s.jsx)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{_(e=>({...e,acceptanceCriteria:[...e.acceptanceCriteria,""]}))},disabled:j,children:"Add Criteria"})]}),(0,s.jsx)("div",{className:"space-y-2",children:q.acceptanceCriteria.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.p,{placeholder:"Criteria ".concat(t+1),value:e,onChange:e=>{var a;return a=e.target.value,void _(e=>({...e,acceptanceCriteria:e.acceptanceCriteria.map((e,s)=>s===t?a:e)}))},disabled:j}),q.acceptanceCriteria.length>1&&(0,s.jsx)(c.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>{_(e=>({...e,acceptanceCriteria:e.acceptanceCriteria.filter((e,a)=>a!==t)}))},disabled:j,children:"\xd7"})]},t))})]}),k&&(0,s.jsx)("div",{className:"text-sm text-red-400 bg-red-400/10 border border-red-400/20 rounded-lg px-3 py-2",children:k})]}),(0,s.jsxs)(l.Es,{children:[(0,s.jsx)(c.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:j,children:"Cancel"}),(0,s.jsx)(c.$,{type:"submit",loading:j,children:f?"Update Story":"Create Story"})]})]})})})}},62401:(e,t,a)=>{a.d(t,{j:()=>r});var s=a(40515);class r{static canAccessContextLevel(e,t){return s.Mh[e].includes(t)}static getMaxContextLevel(e){let t=s.Mh[e];return t[t.length-1]}static getDefaultContextLevel(e){switch(e){case s.Kx.STARTER:return s.yT.MINIMAL;case s.Kx.CORE:case s.Kx.PRO:return s.yT.STANDARD;case s.Kx.TEAM:case s.Kx.ENTERPRISE:return s.yT.COMPREHENSIVE}}static getActionsRequired(e){return s._E[e].actionsRequired}static canAffordGeneration(e,t,a){let r=this.getActionsRequired(e),i=s.wL[t],n=i-a,l=a/i*100>=90;return n<r?{allowed:!1,reason:"Insufficient AI actions. Need ".concat(r,", have ").concat(n," remaining."),actionsRequired:r,actionsRemaining:n,nearLimit:l}:{allowed:!0,actionsRequired:r,actionsRemaining:n,nearLimit:l}}static getUpgradeMessage(e,t){var a,r;return null!=(r=null==(a=({[s.Kx.STARTER]:{[s.yT.STANDARD]:"Upgrade to Core (\xa310.99/mo) to use project context for 30-40% better accuracy",[s.yT.COMPREHENSIVE]:"Upgrade to Pro (\xa319.99/mo) to use epic context with semantic search",[s.yT.COMPREHENSIVE_THINKING]:"Upgrade to Team (\xa316.99/user) for advanced reasoning mode",[s.yT.MINIMAL]:""},[s.Kx.CORE]:{[s.yT.COMPREHENSIVE]:"Upgrade to Pro (\xa319.99/mo) to unlock semantic search with epic context",[s.yT.COMPREHENSIVE_THINKING]:"Upgrade to Team (\xa316.99/user) for advanced reasoning mode",[s.yT.STANDARD]:"",[s.yT.MINIMAL]:""},[s.Kx.PRO]:{[s.yT.COMPREHENSIVE_THINKING]:"Upgrade to Team (\xa316.99/user) to unlock thinking mode for complex stories",[s.yT.COMPREHENSIVE]:"",[s.yT.STANDARD]:"",[s.yT.MINIMAL]:""},[s.Kx.TEAM]:{[s.yT.COMPREHENSIVE_THINKING]:"",[s.yT.COMPREHENSIVE]:"",[s.yT.STANDARD]:"",[s.yT.MINIMAL]:""},[s.Kx.ENTERPRISE]:{[s.yT.COMPREHENSIVE_THINKING]:"",[s.yT.COMPREHENSIVE]:"",[s.yT.STANDARD]:"",[s.yT.MINIMAL]:""}})[e])?void 0:a[t])?r:""}static getMonthlyLimit(e){return s.wL[e]}static getActionsRemaining(e,t){return Math.max(0,this.getMonthlyLimit(e)-t)}static isNearLimit(e,t){return t>=.9*this.getMonthlyLimit(e)}static getAllowedContextLevels(e){return s.Mh[e]}}}}]);
try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="e5970773-bdc1-4112-927d-7f905b00df5e",e._sentryDebugIdIdentifier="sentry-dbid-e5970773-bdc1-4112-927d-7f905b00df5e")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5465],{7220:(e,s,t)=>{"use strict";t.d(s,{SQ:()=>p,_2:()=>h,lp:()=>u,mB:()=>x,rI:()=>d,ty:()=>m});var a=t(95155),i=t(12115),r=t(95736),l=t(27937),n=t(5917),o=t(99051),c=t(25016);let d=r.bL,m=r.l9;r.YJ,r.ZL,r.Pb,r.z6,i.forwardRef((e,s)=>{let{className:t,inset:i,children:n,...o}=e;return(0,a.jsxs)(r.ZP,{ref:s,className:(0,c.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-800 dark:data-[state=open]:bg-gray-800",i&&"pl-8",t),...o,children:[n,(0,a.jsx)(l.A,{className:"ml-auto h-4 w-4"})]})}).displayName=r.ZP.displayName,i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.G5,{ref:s,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",t),...i})}).displayName=r.G5.displayName;let p=i.forwardRef((e,s)=>{let{className:t,sideOffset:i=4,...l}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsx)(r.UC,{ref:s,sideOffset:i,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",t),...l})})});p.displayName=r.UC.displayName;let h=i.forwardRef((e,s)=>{let{className:t,inset:i,...l}=e;return(0,a.jsx)(r.q7,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",i&&"pl-8",t),...l})});h.displayName=r.q7.displayName,i.forwardRef((e,s)=>{let{className:t,children:i,checked:l,...o}=e;return(0,a.jsxs)(r.H_,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",t),checked:l,...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})}),i]})}).displayName=r.H_.displayName,i.forwardRef((e,s)=>{let{className:t,children:i,...l}=e;return(0,a.jsxs)(r.hN,{ref:s,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),i]})}).displayName=r.hN.displayName;let u=i.forwardRef((e,s)=>{let{className:t,inset:i,...l}=e;return(0,a.jsx)(r.JU,{ref:s,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",i&&"pl-8",t),...l})});u.displayName=r.JU.displayName;let x=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-gray-200 dark:bg-gray-800",t),...i})});x.displayName=r.wv.displayName},18155:(e,s,t)=>{Promise.resolve().then(t.bind(t,46070)),Promise.resolve().then(t.bind(t,77866)),Promise.resolve().then(t.t.bind(t,52619,23))},32559:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>o,TN:()=>d,XL:()=>c});var a=t(95155),i=t(12115),r=t(83101),l=t(25016);let n=(0,r.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=i.forwardRef((e,s)=>{let{className:t,variant:i,...r}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,l.cn)(n({variant:i}),t),...r})});o.displayName="Alert";let c=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("h5",{ref:s,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",t),...i})});c.displayName="AlertTitle";let d=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",t),...i})});d.displayName="AlertDescription"},33789:(e,s,t)=>{"use strict";t.d(s,{p:()=>l});var a=t(95155),i=t(12115),r=t(25016);let l=i.forwardRef((e,s)=>{let{className:t,type:i,...l}=e;return(0,a.jsx)("input",{type:i,className:(0,r.cn)("flex h-10 w-full rounded-lg border border-gray-700 bg-gray-800/50 px-3 py-2 text-sm text-white placeholder:text-gray-400","ring-offset-gray-900 file:border-0 file:bg-transparent file:text-sm file:font-medium","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-purple-500 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","transition-all hover:border-gray-600",t),ref:s,...l})});l.displayName="Input"},47507:(e,s,t)=>{"use strict";t.d(s,{l:()=>n});var a=t(95155),i=t(12115),r=t(25016),l=t(24033);let n=i.forwardRef((e,s)=>{let{className:t,children:i,...n}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{className:(0,r.cn)("flex h-10 w-full appearance-none rounded-lg border border-gray-700 bg-gray-800/50 px-3 py-2 pr-10 text-sm text-white","ring-offset-gray-900","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-purple-500 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","transition-all hover:border-gray-600",t),ref:s,...n,children:i}),(0,a.jsx)(l.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]})});n.displayName="Select"},54679:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>m,Es:()=>h,L3:()=>u,c7:()=>p,lG:()=>o,rr:()=>x});var a=t(95155),i=t(12115),r=t(89511),l=t(65229),n=t(25016);let o=r.bL;r.l9;let c=r.ZL;r.bm;let d=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.hJ,{ref:s,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i})});d.displayName=r.hJ.displayName;let m=i.forwardRef((e,s)=>{let{className:t,children:i,...o}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(d,{}),(0,a.jsxs)(r.UC,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-[calc(100%-2rem)] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-700 bg-gray-800/95 backdrop-blur-xl p-4 sm:p-6 shadow-2xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg sm:rounded-lg",t),...o,children:[i,(0,a.jsxs)(r.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-gray-900 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-brand-purple-500 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-700 data-[state=open]:text-gray-200",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.UC.displayName;let p=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};p.displayName="DialogHeader";let h=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};h.displayName="DialogFooter";let u=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.hE,{ref:s,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight text-white",t),...i})});u.displayName=r.hE.displayName;let x=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.VY,{ref:s,className:(0,n.cn)("text-sm text-gray-400",t),...i})});x.displayName=r.VY.displayName},55850:(e,s,t)=>{"use strict";t.d(s,{k:()=>n});var a=t(95155),i=t(12115),r=t(9484),l=t(25016);let n=i.forwardRef((e,s)=>{let{className:t,value:i,...n}=e;return(0,a.jsx)(r.bL,{ref:s,className:(0,l.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...n,children:(0,a.jsx)(r.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(i||0),"%)")}})})});n.displayName=r.bL.displayName},67001:(e,s,t)=>{"use strict";t.d(s,{T:()=>l});var a=t(95155),i=t(12115),r=t(25016);let l=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-lg border border-gray-700 bg-gray-800/50 px-3 py-2 text-sm text-white placeholder:text-gray-400","ring-offset-gray-900","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-purple-500 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","transition-all hover:border-gray-600","resize-vertical",t),ref:s,...i})});l.displayName="Textarea"},77866:(e,s,t)=>{"use strict";t.d(s,{StoryDetailClient:()=>eP});var a=t(95155),i=t(12115),r=t(20063),l=t(83209),n=t(67812),o=t(97003),c=t(33789),d=t(67001),m=t(47507),p=t(18720),h=t(53298);function u(e){let{storyId:s,currentUserId:t}=e,[r,n]=(0,i.useState)([]),[c,m]=(0,i.useState)(""),[u,x]=(0,i.useState)(null),[g,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{f()},[s]);let f=async()=>{try{let e=await fetch("/api/comments?storyId=".concat(s));if(!e.ok)throw Error("Failed to load comments");let t=await e.json();n(t)}catch(e){p.o.error("Failed to load comments")}},j=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(c.trim()){y(!0);try{let t=[...c.matchAll(/@(\w+)/g)].map(e=>e[1]);if(!(await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyId:s,content:c,parentCommentId:e,mentions:t})})).ok)throw Error("Failed to post comment");m(""),x(null),await f(),p.o.success("Comment posted")}catch(e){p.o.error("Failed to post comment")}finally{y(!1)}}},v=async e=>{if(confirm("Delete this comment?"))try{if(!(await fetch("/api/comments/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete comment");await f(),p.o.success("Comment deleted")}catch(e){p.o.error("Failed to delete comment")}},b=async(e,s)=>{try{if(!(await fetch("/api/comments/".concat(e,"/reactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:s})})).ok)throw Error("Failed to add reaction");await f()}catch(e){p.o.error("Failed to add reaction")}},N=r.filter(e=>!e.parentCommentId),w=e=>{var s;let n,{comment:y,isReply:f=!1}=e,[N,k]=(0,i.useState)(!1);return(0,a.jsxs)(l.Zp,{id:"comment-".concat(y.id),className:"p-4 ".concat(f?"ml-8 mt-2":"mb-4"," scroll-mt-20"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white text-sm font-semibold",children:(null==(s=y.author.name)?void 0:s.charAt(0).toUpperCase())||"U"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold text-sm",children:y.author.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:(0,h.m)(new Date(y.createdAt),{addSuffix:!0})})]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>{let e="".concat(window.location.origin).concat(window.location.pathname,"#comment-").concat(y.id);navigator.clipboard.writeText(e),k(!0),p.o.success("Comment link copied"),setTimeout(()=>k(!1),2e3)},className:"text-muted-foreground hover:text-foreground",title:"Copy link to comment",children:N?"✓":"\uD83D\uDD17"}),y.userId===t&&(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>v(y.id),className:"text-red-500 hover:text-red-700",children:"Delete"})]})]}),(0,a.jsx)("div",{className:"text-sm mb-3 whitespace-pre-wrap",children:y.content}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>b(y.id,"\uD83D\uDC4D"),children:["\uD83D\uDC4D ",y.reactionCount>0&&y.reactionCount]}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>b(y.id,"❤️"),children:"❤️"}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>x(y.id),children:"Reply"})]}),u===y.id&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)(d.T,{placeholder:"Write a reply...",value:c,onChange:e=>m(e.target.value),className:"mb-2"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.$,{onClick:()=>j(y.id),disabled:g,children:g?"Posting...":"Reply"}),(0,a.jsx)(o.$,{variant:"ghost",onClick:()=>x(null),children:"Cancel"})]})]}),(n=y.id,r.filter(e=>e.parentCommentId===n)).map(e=>(0,a.jsx)(w,{comment:e,isReply:!0},e.id))]},y.id)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["Comments (",r.length,")"]}),(0,a.jsxs)(l.Zp,{className:"p-4",children:[(0,a.jsx)(d.T,{placeholder:"Add a comment... Use @username to mention",value:c,onChange:e=>m(e.target.value),className:"mb-2",rows:3}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Tip: Use @username to mention someone"}),(0,a.jsx)(o.$,{onClick:()=>j(),disabled:g,children:g?"Posting...":"Comment"})]})]}),(0,a.jsx)("div",{children:N.map(e=>(0,a.jsx)(w,{comment:e},e.id))}),0===r.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No comments yet. Be the first to comment!"})]})}var x=t(49476),g=t(5917),y=t(65229),f=t(71360),j=t(6191),v=t(2327),b=t(25016),N=t(17787),w=t(49027),k=t(27587);function C(e){let{id:s,text:t,index:r,isCompleted:l,onToggle:n,onDelete:d,onEdit:m}=e,[p,h]=i.useState(!1),[u,j]=i.useState(t),{attributes:v,listeners:N,setNodeRef:C,transform:A,transition:S,isDragging:_}=(0,w.gl)({id:s}),E={transform:k.Ks.Transform.toString(A),transition:S,opacity:_?.5:1},I=()=>{u.trim()&&(m(r,u),h(!1))},P=()=>{j(t),h(!1)};return(0,a.jsxs)("div",{ref:C,style:E,className:(0,b.cn)("flex items-start gap-2 p-3 rounded-lg border bg-card group hover:border-purple-500/50 transition-colors",_&&"opacity-50"),children:[(0,a.jsx)("button",{className:"cursor-grab active:cursor-grabbing mt-1 opacity-0 group-hover:opacity-100 transition-opacity",...v,...N,children:(0,a.jsx)(x.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)("button",{className:(0,b.cn)("mt-1 h-4 w-4 rounded border flex-shrink-0",l?"bg-green-500 border-green-500":"border-muted-foreground"),onClick:()=>n(r),"aria-label":"Toggle completion",children:l&&(0,a.jsx)(g.A,{className:"h-3 w-3 text-white"})}),p?(0,a.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,a.jsx)(c.p,{value:u,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&I(),"Escape"===e.key&&P()},autoFocus:!0,className:"flex-1"}),(0,a.jsx)(o.$,{size:"sm",onClick:I,children:(0,a.jsx)(g.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{size:"sm",variant:"ghost",onClick:P,children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:(0,b.cn)("flex-1 text-sm cursor-pointer",l&&"line-through text-muted-foreground"),onClick:()=>h(!0),children:t}),(0,a.jsx)(o.$,{size:"sm",variant:"ghost",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>d(r),children:(0,a.jsx)(f.A,{className:"h-4 w-4 text-red-400"})})]})]})}function A(e){let{storyId:s,acceptanceCriteria:t,onUpdate:r}=e,[n,d]=i.useState(t),[m,h]=i.useState(""),[u,x]=i.useState(new Set),[g,y]=i.useState(!1),f=(0,N.FR)((0,N.MS)(N.AN),(0,N.MS)(N.uN,{coordinateGetter:w.JR})),b=async e=>{y(!0);try{await v.F.stories.update(s,{acceptanceCriteria:e}),d(e),r(e),p.o.success("Acceptance criteria updated")}catch(e){p.o.error(e.message||"Failed to update acceptance criteria")}finally{y(!1)}},k=async()=>{if(!m.trim())return;let e=[...n,m];await b(e),h("")},A=async e=>{let s=n.filter((s,t)=>t!==e);await b(s);let t=new Set;u.forEach(s=>{s<e?t.add(s):s>e&&t.add(s-1)}),x(t)},S=async(e,s)=>{let t=[...n];t[e]=s,await b(t)},_=e=>{let s=new Set(u);s.has(e)?s.delete(e):s.add(e),x(s)},E=async e=>{let{active:s,over:t}=e;if(t&&s.id!==t.id){let e=n.findIndex((e,t)=>"ac-".concat(t)===s.id),a=n.findIndex((e,s)=>"ac-".concat(s)===t.id),i=(0,w.be)(n,e,a);await b(i);let r=new Set;u.forEach(s=>{s===e?r.add(a):s<e&&s>=a?r.add(s+1):s>e&&s<=a?r.add(s-1):r.add(s)}),x(r)}},I=u.size,P=n.length;return(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(l.ZB,{className:"text-lg",children:"Acceptance Criteria"}),P>0&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[I," / ",P," completed"]})]})}),(0,a.jsxs)(l.Wu,{className:"space-y-3",children:[(0,a.jsx)(N.Mp,{sensors:f,collisionDetection:N.fp,onDragEnd:E,children:(0,a.jsx)(w.gB,{items:n.map((e,s)=>"ac-".concat(s)),strategy:w._G,children:n.map((e,s)=>(0,a.jsx)(C,{id:"ac-".concat(s),text:e,index:s,isCompleted:u.has(s),onToggle:_,onDelete:A,onEdit:S},"ac-".concat(s)))})}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)(c.p,{value:m,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&k()},placeholder:"Add acceptance criteria...",disabled:g}),(0,a.jsxs)(o.$,{onClick:k,disabled:g||!m.trim(),children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Add"]})]}),0===n.length&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No acceptance criteria yet. Add one above to get started."})]})]})}var S=t(49264),_=t(45010),E=t(61362),I=t(99051),P=t(26983),T=t(6132),R=t(38162);let F=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(R.bL,{ref:s,className:(0,b.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...i,children:(0,a.jsx)(R.C1,{className:(0,b.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})})});F.displayName=R.bL.displayName;var z=t(7220),D=t(46591);let L=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(D.bL,{ref:s,className:(0,b.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...i})});L.displayName=D.bL.displayName;let $=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(D._V,{ref:s,className:(0,b.cn)("aspect-square h-full w-full",t),...i})});$.displayName=D._V.displayName;let Z=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(D.H4,{ref:s,className:(0,b.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...i})});Z.displayName=D.H4.displayName;var U=t(20017),H=t(21190),G=t(48248);let V={todo:I.A,in_progress:P.A,done:E.A,blocked:T.A},O={todo:"text-muted-foreground",in_progress:"text-blue-500",done:"text-green-500",blocked:"text-red-500"},B={low:"border-gray-500/20 bg-gray-500/5 text-gray-400",medium:"border-blue-500/20 bg-blue-500/5 text-blue-400",high:"border-orange-500/20 bg-orange-500/5 text-orange-400",critical:"border-red-500/20 bg-red-500/5 text-red-400"};function W(e){var s;let{task:t,onUpdate:r,onDelete:l}=e,[c,d]=i.useState(!1),[m,h]=i.useState(!1),[u,x]=i.useState(!1),g=V[t.status],y=async()=>{x(!0);try{let e="done"===t.status?"todo":"done";if(!(await fetch("/api/tasks/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})})).ok)throw Error("Failed to update task");r()}catch(e){p.o.error("Failed to update task status")}finally{x(!1)}},j=async()=>{if(confirm("Are you sure you want to delete this task?")){h(!0);try{if(!(await fetch("/api/tasks/".concat(t.id),{method:"DELETE"})).ok)throw Error("Failed to delete task");l()}catch(e){p.o.error("Failed to delete task")}finally{h(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,b.cn)("group flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-accent/5 transition-colors","done"===t.status&&"opacity-60"),children:[(0,a.jsx)(F,{checked:"done"===t.status,onCheckedChange:y,disabled:u,className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(g,{className:(0,b.cn)("h-4 w-4 mt-0.5 flex-shrink-0",O[t.status])}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:(0,b.cn)("font-medium","done"===t.status&&"line-through text-muted-foreground"),children:t.title}),t.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:t.description})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)(n.E,{variant:"outline",className:(0,b.cn)("text-xs",B[t.priority]),children:t.priority}),t.estimatedHours&&(0,a.jsxs)(n.E,{variant:"secondary",className:"text-xs",children:[(0,a.jsx)(P.A,{className:"h-3 w-3 mr-1"}),t.estimatedHours,"h",t.actualHours&&" / ".concat(t.actualHours,"h")]}),t.assignee&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(L,{className:"h-5 w-5",children:[(0,a.jsx)($,{src:t.assignee.avatar||void 0}),(0,a.jsx)(Z,{className:"text-xs",children:(null==(s=t.assignee.name)?void 0:s[0])||t.assignee.email[0].toUpperCase()})]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:t.assignee.name||t.assignee.email})]}),t.tags&&t.tags.length>0&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:t.tags.map(e=>(0,a.jsx)(n.E,{variant:"secondary",className:"text-xs",children:e},e))})]})]}),(0,a.jsxs)(z.rI,{children:[(0,a.jsx)(z.ty,{asChild:!0,children:(0,a.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(U.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(z.SQ,{align:"end",children:[(0,a.jsxs)(z._2,{onClick:()=>d(!0),children:[(0,a.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,a.jsx)(z.mB,{}),(0,a.jsxs)(z._2,{onClick:j,disabled:m,className:"text-destructive",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),(0,a.jsx)(G.G,{open:c,onOpenChange:d,storyId:t.storyId,projectId:t.projectId,task:t,onSuccess:()=>{d(!1),r()}})]})}function q(e){let{storyId:s,projectId:t,tasks:r,stats:c,onTasksChange:d}=e,[m,h]=i.useState(!1),u=()=>{d()},x=()=>{d(),p.o.success("Task deleted")},g=c.total>0?Math.round(c.done/c.total*100):0;return(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(l.ZB,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(E.A,{className:"h-5 w-5"}),"Tasks",(0,a.jsx)(n.E,{variant:"secondary",children:c.total})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Break down this story into smaller tasks"})]}),(0,a.jsxs)(o.$,{onClick:()=>h(!0),size:"sm",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Add Task"]})]})}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[c.total>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Progress"}),(0,a.jsxs)("span",{className:"font-medium",children:[g,"%"]})]}),(0,a.jsx)("div",{className:"h-2 bg-secondary rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-primary transition-all",style:{width:"".concat(g,"%")}})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[c.todo>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:[c.todo," To Do"]})]}),c.inProgress>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 text-blue-500"}),(0,a.jsxs)("span",{className:"text-blue-500",children:[c.inProgress," In Progress"]})]}),c.done>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(E.A,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("span",{className:"text-green-500",children:[c.done," Done"]})]}),c.blocked>0&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-red-500"}),(0,a.jsxs)("span",{className:"text-red-500",children:[c.blocked," Blocked"]})]})]}),(c.totalEstimatedHours>0||c.totalActualHours>0)&&(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[c.totalEstimatedHours>0&&(0,a.jsxs)("span",{children:["Estimated: ",c.totalEstimatedHours,"h"]}),c.totalActualHours>0&&(0,a.jsxs)("span",{children:["Actual: ",c.totalActualHours,"h"]})]})]}),0===r.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),(0,a.jsx)("p",{children:"No tasks yet"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Break down this story into smaller tasks to track progress"})]}):(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsx)(W,{task:e,onUpdate:u,onDelete:x},e.id))})]}),(0,a.jsx)(G.G,{open:m,onOpenChange:h,storyId:s,projectId:t,onSuccess:()=>{h(!1),d(),p.o.success("Task created successfully")}})]})}var M=t(35633),K=t(54679),J=t(22454),Q=t(99776),Y=t(80549);let X={getAnalysis:async e=>{let s=await fetch("/api/stories/".concat(e,"/split-analysis"),{credentials:"include"});if(!s.ok)throw Error("Failed to fetch analysis");return s.json()},splitStory:async(e,s)=>{let t=await fetch("/api/stories/".concat(e,"/split"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!t.ok)throw Error((await t.json()).error||"Split failed");return t.json()}};var ee=t(78874);let es={"common.cancel":"Cancel","story.split.title":"Split Story","story.split.description":"Decompose this story into smaller, independently valuable stories following INVEST principles","story.split.analyzing":"Analyzing story...","story.split.convert_to_epic":"Convert parent story to epic","story.split.create_stories":"Create {{count}} stories","story.split.creating":"Creating stories...","story.split.suggest":"Suggest splits","story.split.add_child":"Add child story","story.split.blocking.already_optimal":"Splitting not recommended: story already fits timebox and remains independently valuable","story.split.blocking.create_subtasks":"Create sub-tasks instead","story.split.analysis.invest":"INVEST Analysis","story.split.analysis.invest.score":"INVEST Score","story.split.analysis.invest.valuable":"Valuable","story.split.analysis.invest.independent":"Independent","story.split.analysis.invest.small":"Small","story.split.analysis.invest.testable":"Testable","story.split.analysis.invest.estimable":"Estimable","story.split.analysis.invest.valuable.no_description":"Missing or insufficient description","story.split.analysis.invest.valuable.no_acceptance_criteria":"No acceptance criteria defined","story.split.analysis.invest.independent.has_dependencies":"Story has dependencies on other work","story.split.analysis.invest.small.no_estimate":"Story is not estimated","story.split.analysis.invest.small.too_large":"Story is too large for one sprint","story.split.analysis.invest.testable.unclear_criteria":"Acceptance criteria are not clear or testable","story.split.analysis.invest.estimable.missing":"Story lacks estimate","story.split.analysis.spidr":"SPIDR Splitting Strategies","story.split.analysis.spidr.no_suggestions":"No splitting strategies detected","story.split.analysis.recommended":"✓ Splitting recommended","story.split.analysis.not_recommended":"⚠ Splitting may not provide value","story.split.children.title":"Child Stories","story.split.children.empty":"No child stories yet","story.split.children.empty_hint":'Click "Suggest splits" or "Add child story" to begin',"story.split.child.number":"Story {{number}}","story.split.child.remove":"Remove story","story.split.child.title":"Title","story.split.child.title_placeholder":"As a [persona], I want to...","story.split.child.persona_goal":"Persona-Goal Statement","story.split.child.persona_goal_placeholder":"As a [persona], I want [capability] so that [benefit]","story.split.child.description":"Description","story.split.child.description_placeholder":"Describe what this story delivers...","story.split.child.acceptance_criteria":"Acceptance Criteria","story.split.child.add_ac":"Add criterion","story.split.child.ac_placeholder":"Given... When... Then...","story.split.child.estimate":"Story Points","story.split.child.provides_user_value":"Provides user-visible value","story.split.validation.valuable.no_user_value":"Story must provide user-visible value","story.split.validation.valuable.missing_persona_goal":"Persona-goal statement is required (min 10 characters)","story.split.validation.valuable.description_too_short":"Description must be at least 20 characters","story.split.validation.valuable.no_acceptance_criteria":"At least one acceptance criterion is required","story.split.validation.independent.coupling_detected":"Potential coupling detected with another story","story.split.validation.independent.has_dependencies":"Story has dependencies","story.split.validation.small.missing_estimate":"Story points estimate is required","story.split.validation.small.too_large":"Story is too large (max 5 points)","story.split.validation.testable.insufficient_criteria":"At least 2 acceptance criteria required","story.split.validation.testable.vague_criteria":"Acceptance criteria contain vague terms","story.split.spidr.spike.suggestion":"Consider creating a research spike to reduce uncertainty","story.split.spidr.paths.suggestion":"Split by alternate paths or workflows","story.split.spidr.interfaces.suggestion":"Split by interface layers (UI first, then API)","story.split.spidr.data.suggestion":"Split by data formats or subsets","story.split.spidr.rules.suggestion":"Start with relaxed validation, add stricter rules later"};function et(){return{t:(e,s)=>{let t=es[e]||e;return s&&Object.keys(s).forEach(e=>{t=t.replace(RegExp("{{".concat(e,"}}"),"g"),String(s[e]))}),t}}}function ea(e){let{analysis:s,isLoading:t,isError:i}=e,{t:r}=et();if(i)return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-base",children:"Analysis"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-foreground mb-1",children:"Analysis unavailable"}),(0,a.jsx)("p",{children:"You can still manually create child stories using the editor on the right."})]})]})})]})});if(t||!s)return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-base",children:"Analysis"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 animate-pulse"}),(0,a.jsx)("p",{children:"Loading analysis..."})]})})]})});let o=s.invest.score;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-base",children:r("story.split.analysis.invest")})}),(0,a.jsxs)(l.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:r("story.split.analysis.invest.score")}),(0,a.jsxs)(n.E,{variant:o>=4?"default":"destructive",children:[o,"/5"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ei,{label:r("story.split.analysis.invest.valuable"),passed:s.invest.valuable}),(0,a.jsx)(ei,{label:r("story.split.analysis.invest.independent"),passed:s.invest.independent}),(0,a.jsx)(ei,{label:r("story.split.analysis.invest.small"),passed:s.invest.small}),(0,a.jsx)(ei,{label:r("story.split.analysis.invest.testable"),passed:s.invest.testable}),(0,a.jsx)(ei,{label:r("story.split.analysis.invest.estimable"),passed:s.invest.estimable})]}),s.invest.notes.length>0&&(0,a.jsx)("div",{className:"mt-4 space-y-1",children:s.invest.notes.map((e,s)=>(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["• ",r(e)]},s))})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-base",children:r("story.split.analysis.spidr")})}),(0,a.jsx)(l.Wu,{className:"space-y-3",children:s.spidr.suggestions.length>0?(0,a.jsx)("div",{className:"space-y-2",children:s.spidr.suggestions.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-sm",children:r(e)})]},s))}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:r("story.split.analysis.spidr.no_suggestions")})})]}),s.splittingRecommended?(0,a.jsx)(l.Zp,{className:"border-green-200 bg-green-50 dark:bg-green-950",children:(0,a.jsx)(l.Wu,{className:"pt-6",children:(0,a.jsx)("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:r("story.split.analysis.recommended")})})}):(0,a.jsx)(l.Zp,{className:"border-yellow-200 bg-yellow-50 dark:bg-yellow-950",children:(0,a.jsx)(l.Wu,{className:"pt-6",children:(0,a.jsx)("p",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100",children:r("story.split.analysis.not_recommended")})})})]})}function ei(e){let{label:s,passed:t}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t?(0,a.jsx)(E.A,{className:"h-4 w-4 text-green-500"}):(0,a.jsx)(ee.A,{className:"h-4 w-4 text-red-500"}),(0,a.jsx)("span",{className:"text-sm",children:s})]})}var er=t(52056),el=t(23327),en=t(35299),eo=t(95740);function ec(e){let{child:s,index:t,validation:i,onChange:r,onRemove:n,disabled:m}=e,{t:p}=et(),h=(e,t)=>{r({...s,[e]:t})};return(0,a.jsxs)(l.Zp,{className:(null==i?void 0:i.valid)===!1?"border-red-300":"",children:[(0,a.jsx)(l.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-semibold text-sm",children:p("story.split.child.number",{number:t+1})}),(0,a.jsx)(ed,{validation:i})]}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:n,disabled:m,"aria-label":p("story.split.child.remove"),children:(0,a.jsx)(f.A,{className:"h-4 w-4"})})]})}),(0,a.jsxs)(l.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"title-".concat(t),className:"text-sm font-medium",children:p("story.split.child.title")}),(0,a.jsx)(c.p,{id:"title-".concat(t),value:s.title,onChange:e=>h("title",e.target.value),placeholder:p("story.split.child.title_placeholder"),disabled:m,className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"persona-goal-".concat(t),className:"text-sm font-medium",children:p("story.split.child.persona_goal")}),(0,a.jsx)(d.T,{id:"persona-goal-".concat(t),value:s.personaGoal,onChange:e=>h("personaGoal",e.target.value),placeholder:p("story.split.child.persona_goal_placeholder"),disabled:m,className:"mt-1",rows:2})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description-".concat(t),className:"text-sm font-medium",children:p("story.split.child.description")}),(0,a.jsx)(d.T,{id:"description-".concat(t),value:s.description,onChange:e=>h("description",e.target.value),placeholder:p("story.split.child.description_placeholder"),disabled:m,className:"mt-1",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:p("story.split.child.acceptance_criteria")}),(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>{r({...s,acceptanceCriteria:[...s.acceptanceCriteria,""]})},disabled:m,children:p("story.split.child.add_ac")})]}),(0,a.jsx)("div",{className:"space-y-2",children:s.acceptanceCriteria.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.T,{value:e,onChange:e=>((e,t)=>{let a=[...s.acceptanceCriteria];a[e]=t,r({...s,acceptanceCriteria:a})})(t,e.target.value),placeholder:p("story.split.child.ac_placeholder"),disabled:m,rows:2,className:"flex-1"}),s.acceptanceCriteria.length>1&&(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>{r({...s,acceptanceCriteria:s.acceptanceCriteria.filter((e,s)=>s!==t)})},disabled:m,children:(0,a.jsx)(f.A,{className:"h-4 w-4"})})]},t))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"estimate-".concat(t),className:"text-sm font-medium",children:p("story.split.child.estimate")}),(0,a.jsx)(c.p,{id:"estimate-".concat(t),type:"number",min:1,max:5,value:s.estimatePoints,onChange:e=>h("estimatePoints",parseInt(e.target.value)),disabled:m,className:"mt-1"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-6",children:[(0,a.jsx)(F,{id:"user-value-".concat(t),checked:s.providesUserValue,onCheckedChange:e=>h("providesUserValue",!0===e),disabled:m}),(0,a.jsx)("label",{htmlFor:"user-value-".concat(t),className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:p("story.split.child.provides_user_value")})]})]}),i&&!i.valid&&(0,a.jsx)("div",{className:"mt-3 space-y-1",children:i.errors.map((e,s)=>(0,a.jsxs)("p",{className:"text-sm text-red-600 flex items-start gap-2",children:[(0,a.jsx)(ee.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),p(e)]},s))}),i&&i.warnings.length>0&&(0,a.jsx)("div",{className:"mt-3 space-y-1",children:i.warnings.map((e,s)=>(0,a.jsxs)("p",{className:"text-sm text-yellow-600 flex items-start gap-2",children:[(0,a.jsx)(er.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),p(e)]},s))})]})]})}function ed(e){let{validation:s}=e;return s?(0,a.jsxs)("div",{className:"flex gap-1",children:[s.valuable&&(0,a.jsxs)(n.E,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(E.A,{className:"h-3 w-3 mr-1 text-green-500"}),"V"]}),s.independent&&(0,a.jsxs)(n.E,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(E.A,{className:"h-3 w-3 mr-1 text-green-500"}),"I"]}),s.small&&(0,a.jsxs)(n.E,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(E.A,{className:"h-3 w-3 mr-1 text-green-500"}),"S"]}),s.testable&&(0,a.jsxs)(n.E,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(E.A,{className:"h-3 w-3 mr-1 text-green-500"}),"T"]})]}):null}class em{static getInstance(){return em.instance||(em.instance=new em),em.instance}increment(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2?arguments[2]:void 0,a=this.getKey(e,t),i=this.metrics.get(a)||0;this.metrics.set(a,i+s)}gauge(e,s,t){let a=this.getKey(e,t);this.metrics.set(a,s)}timing(e,s,t){let a=this.getKey(e,t);this.metrics.set(a,s)}histogram(e,s,t){let a=this.getKey(e,t);this.metrics.set(a,s)}getKey(e,s){if(!s)return e;let t=Object.entries(s).map(e=>{let[s,t]=e;return"".concat(s,":").concat(t)}).join(",");return"".concat(e,"{").concat(t,"}")}getAll(){return Object.fromEntries(this.metrics)}constructor(){this.metrics=new Map}}let ep=em.getInstance();class eh{validateChild(e,s){let t=[],a=[],i=this.validateValuable(e,t),r=this.validateIndependent(e,s,a),l=this.validateSmall(e,t),n=this.validateTestable(e,t,a),o=0===t.length&&i&&n;return ep.increment("story_split.child_validation",1,{valid:o.toString(),valuable:i.toString(),testable:n.toString()}),{valid:o,valuable:i,independent:r,small:l,testable:n,errors:t,warnings:a}}validateValuable(e,s){return e.providesUserValue?!e.personaGoal||e.personaGoal.trim().length<10?(s.push("story.split.validation.valuable.missing_persona_goal"),!1):!e.description||e.description.trim().length<20?(s.push("story.split.validation.valuable.description_too_short"),!1):!!e.acceptanceCriteria&&0!==e.acceptanceCriteria.length||(s.push("story.split.validation.valuable.no_acceptance_criteria"),!1):(s.push("story.split.validation.valuable.no_user_value"),!1)}validateIndependent(e,s,t){let a=s.indexOf(e);for(let i of s.filter((e,s)=>s!==a))this.detectCoupling(e,i)&&t.push("story.split.validation.independent.coupling_detected");return e.optionalDependencies&&e.optionalDependencies.length>0&&t.push("story.split.validation.independent.has_dependencies"),!0}detectCoupling(e,s){let t=e.description.toLowerCase(),a=s.description.toLowerCase(),i=e.title.toLowerCase(),r=s.title.toLowerCase(),l=e=>e.split(" ").filter(e=>e.length>=5).filter(e=>!["password","reset","email","user","secure","request","receive","click"].includes(e)),n=l(i),o=l(r),c=n.filter(e=>o.includes(e)).length,d=t.split(" ").filter(e=>e.length>=5).filter(e=>a.includes(e)).length;return c>=2&&d>=3}validateSmall(e,s){return!e.estimatePoints||e.estimatePoints<=0?(s.push("story.split.validation.small.missing_estimate"),!1):!(e.estimatePoints>this.SMALL_THRESHOLD)||(s.push("story.split.validation.small.too_large"),!1)}validateTestable(e,s,t){if(!e.acceptanceCriteria||e.acceptanceCriteria.length<2)return s.push("story.split.validation.testable.insufficient_criteria"),!1;let a=["properly","correctly","works","good","nice"];return e.acceptanceCriteria.some(e=>{let s=e.toLowerCase();return a.some(e=>RegExp("\\b".concat(e,"\\b"),"i").test(s))})&&t.push("story.split.validation.testable.vague_criteria"),!0}validateAllChildren(e,s){let t=e.map(s=>this.validateChild(s,e));return{allValid:t.every(e=>e.valid),results:t,coverage:s?this.analyzeCoverage(e,s):this.createEmptyCoverage()}}createEmptyCoverage(){return{coveragePercentage:100,parentCriteria:[],coveredCriteria:[],uncoveredCriteria:[],duplicatedFunctionality:[],recommendations:[]}}analyzeCoverage(e,s){let t=[],a=new Map;s.forEach((s,t)=>{a.set(t,new Set),e.forEach((e,i)=>{e.acceptanceCriteria.forEach(e=>{this.criteriaMatch(s,e)&&a.get(t).add(i)})})});let i=[],r=[],l=[];s.forEach((e,s)=>{let n=Array.from(a.get(s)||[]);0===n.length?(r.push(e),t.push('Missing: "'.concat(e.substring(0,50),'..." is not covered by any child story'))):1===n.length?i.push(e):n.length>=3?(i.push(e),l.push({criterionIndex:s,coveredByStories:n}),t.push('Duplication: "'.concat(e.substring(0,50),'..." is covered by ').concat(n.length," stories (").concat(n.map(e=>e+1).join(", "),")"))):i.push(e)});let n=s.length>0?Math.round(i.length/s.length*100):100;return r.length>0?t.unshift("⚠️ Coverage: ".concat(n,"% - ").concat(r.length," criteria not covered")):l.length>0?t.unshift("⚠️ Found ".concat(l.length," potential duplications across child stories")):t.unshift("✅ 100% coverage with no duplication detected"),ep.increment("story_split.coverage_analysis",1,{coverage:n.toString(),hasDuplication:(l.length>0).toString()}),{coveragePercentage:n,parentCriteria:s,coveredCriteria:i,uncoveredCriteria:r,duplicatedFunctionality:l,recommendations:t}}criteriaMatch(e,s){let t=e=>e.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim(),a=t(e),i=t(s),r=e=>e.split(" ").filter(e=>e.length>=5).filter(e=>!["given","when","then","should","must","will","that","this","with","from","their","have","they","them"].includes(e)),l=r(a),n=r(i);if(0===l.length||l.length<2)return!1;let o=l.filter(e=>n.some(s=>s.includes(e)||e.includes(s)));return o.length/l.length>=.6&&o.length>=2}constructor(){this.SMALL_THRESHOLD=5}}let eu=new eh;var ex=t(32559),eg=t(55850),ey=t(36489);let ef=["chrisjrobertson@outlook.com","chris@synqforge.com"];function ej(e){var s;let{childStories:t,onChange:r,onValidationChange:l,disabled:n,analysis:c,storyId:d,parentAcceptanceCriteria:m}=e,{t:h}=et(),{data:u}=(0,ey.useSession)(),[x,g]=(0,i.useState)([]),[y,f]=(0,i.useState)(null),[v,b]=(0,i.useState)(!1),N=function(e){if(!e)return!1;let s=e.toLowerCase().trim();return ef.some(e=>e.toLowerCase()===s)}(null==u||null==(s=u.user)?void 0:s.email);(0,i.useEffect)(()=>{if(0===t.length){l(!1),f(null);return}let e=eu.validateAllChildren(t,m);g(e.results),f(e.coverage);let s=N?e.coverage.coveragePercentage>0:100===e.coverage.coveragePercentage;l(e.allValid&&s)},[t,m,l,N]);let w=async()=>{if(c){b(!0);try{let e=await fetch("/api/stories/".concat(d,"/ai-split-suggestions"),{credentials:"include"});if(!e.ok){let s=await e.json();429===e.status?p.o.error("Too many AI requests",{description:s.retryAfter||"Please try again later"}):402===e.status?p.o.error("AI usage limit reached",{description:s.error||"Please upgrade your plan",action:s.upgradeUrl?{label:"Upgrade",onClick:()=>window.open(s.upgradeUrl,"_blank")}:void 0}):p.o.error("Failed to generate suggestions",{description:s.error||"Please try again"});return}let s=await e.json();if(s.success&&s.suggestions){let e=s.suggestions.map(e=>({title:e.title,personaGoal:e.personaGoal,description:e.description,acceptanceCriteria:e.acceptanceCriteria,estimatePoints:e.estimatePoints,providesUserValue:e.providesUserValue}));r(e),p.o.success("AI suggestions generated",{description:"Created ".concat(e.length," story suggestions using ").concat(s.splitStrategy)})}}catch(e){console.error("Failed to get AI suggestions:",e),p.o.error("Failed to generate suggestions",{description:"Please try again or add stories manually"})}finally{b(!1)}}};return(0,a.jsxs)("div",{className:"space-y-4",children:[y&&m&&m.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[100===y.coveragePercentage&&0===y.duplicatedFunctionality.length?(0,a.jsx)(E.A,{className:"h-5 w-5 text-green-500"}):y.coveragePercentage<100?(0,a.jsx)(er.A,{className:"h-5 w-5 text-orange-500"}):(0,a.jsx)(el.A,{className:"h-5 w-5 text-blue-500"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Coverage: ",y.coveragePercentage,"%"]}),(0,a.jsx)(eg.k,{value:y.coveragePercentage,className:"flex-1 h-2"})]}),y.recommendations.length>0&&(0,a.jsx)(ex.Fc,{variant:100===y.coveragePercentage?"default":"destructive",children:(0,a.jsx)(ex.TN,{children:(0,a.jsx)("div",{className:"space-y-1",children:y.recommendations.map((e,s)=>(0,a.jsx)("div",{className:"text-sm",children:e},s))})})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sticky top-0 bg-background pb-4 z-10",children:[(0,a.jsxs)("h3",{className:"font-semibold",children:[h("story.split.children.title")," (",t.length,")"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[c&&0===t.length&&(0,a.jsx)(o.$,{variant:"default",size:"sm",onClick:w,disabled:n||v,children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.A,{className:"h-4 w-4 mr-2"}),"Suggest Splits"]})}),(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>{r([...t,{title:"",personaGoal:"",description:"",acceptanceCriteria:[""],estimatePoints:3,providesUserValue:!0}])},disabled:n||v,children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-2"}),h("story.split.add_child")]})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:0===t.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-center text-muted-foreground",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-2",children:h("story.split.children.empty")}),(0,a.jsx)("p",{className:"text-sm",children:h("story.split.children.empty_hint")})]})}):t.map((e,s)=>(0,a.jsx)(ec,{child:e,index:s,validation:x[s],onChange:e=>((e,s)=>{let a=[...t];a[e]=s,r(a)})(s,e),onRemove:()=>{r(t.filter((e,t)=>t!==s))},disabled:n},s))})]})}function ev(e){let{storyId:s,open:t,onClose:r}=e,{t:l}=et(),{data:n,isLoading:c,isError:d}=(0,J.I)({queryKey:["story-split-analysis",s],queryFn:()=>X.getAnalysis(s),staleTime:3e5,retry:1,retryDelay:1e3}),m=function(e){let s=(0,Q.jE)();return(0,Y.n)({mutationFn:s=>X.splitStory(e,s),onSuccess:t=>{s.invalidateQueries({queryKey:["story",e]}),s.invalidateQueries({queryKey:["stories"]}),p.o.success("Created ".concat(t.childStories.length," stories"),{description:t.parentStory.isEpic?"Parent converted to epic":"Child stories linked to parent"})},onError:e=>{p.o.error("Split failed",{description:e.message})}})}(s),[h,u]=(0,i.useState)(!1),[x,g]=(0,i.useState)([]),[y,f]=(0,i.useState)(!1),j=(0,i.useRef)(null),v=null==n?void 0:n.analysis,b=(null==n?void 0:n.parentAcceptanceCriteria)||[],N=(null==v?void 0:v.blockingReasons)&&v.blockingReasons.length>0;(0,i.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,r]);let w=async()=>{if(y&&!N)try{await m.mutateAsync({convertParentToEpic:h,children:x,investRationale:null==v?void 0:v.invest,spidrStrategy:null==v?void 0:v.spidr}),r()}catch(e){}};return c?(0,a.jsx)(K.lG,{open:t,onOpenChange:r,children:(0,a.jsxs)(K.Cf,{className:"max-w-6xl h-[80vh]",children:[(0,a.jsxs)(K.c7,{children:[(0,a.jsx)(K.L3,{children:l("story.split.title")}),(0,a.jsx)(K.rr,{className:"sr-only",children:l("story.split.description")})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,a.jsx)(en.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:l("story.split.analyzing")})]})]})}):(0,a.jsx)(K.lG,{open:t,onOpenChange:r,children:(0,a.jsxs)(K.Cf,{className:"max-w-6xl h-[80vh] flex flex-col","aria-describedby":"split-story-description",children:[(0,a.jsxs)(K.c7,{children:[(0,a.jsx)(K.L3,{children:l("story.split.title")}),(0,a.jsx)(K.rr,{id:"split-story-description",children:l("story.split.description")})]}),N&&(0,a.jsxs)(ex.Fc,{variant:"destructive",children:[(0,a.jsx)(T.A,{className:"h-4 w-4"}),(0,a.jsxs)(ex.TN,{children:[v.blockingReasons.map(e=>l(e)).join(". "),(0,a.jsx)(o.$,{variant:"link",size:"sm",className:"ml-2",onClick:r,children:l("story.split.blocking.create_subtasks")})]})]}),(0,a.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-4 min-h-0",children:[(0,a.jsx)("div",{className:"overflow-y-auto",children:(0,a.jsx)(ea,{analysis:v,storyId:s,isLoading:c,isError:d})}),(0,a.jsx)("div",{className:"overflow-y-auto",children:(0,a.jsx)(ej,{childStories:x,onChange:g,onValidationChange:f,disabled:N,analysis:v,storyId:s,parentAcceptanceCriteria:b})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(F,{id:"convert-to-epic",checked:h,onCheckedChange:e=>u(!0===e),disabled:N}),(0,a.jsx)("label",{htmlFor:"convert-to-epic",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:l("story.split.convert_to_epic")})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.$,{ref:j,variant:"outline",onClick:r,children:l("common.cancel")}),(0,a.jsx)(o.$,{onClick:w,disabled:!y||N||m.isPending,children:m.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en.A,{className:"h-4 w-4 mr-2 animate-spin"}),l("story.split.creating")]}):l("story.split.create_stories",{count:x.length})})]})]})]})})}function eb(e){let{storyId:s}=e,[t,r]=(0,i.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>r(!0),"aria-label":"Split story into smaller stories",children:[(0,a.jsx)(M.A,{className:"h-4 w-4 mr-2"}),"Split story"]}),t&&(0,a.jsx)(ev,{storyId:s,open:t,onClose:()=>r(!1)})]})}var eN=t(52619),ew=t.n(eN),ek=t(46046),eC=t(75426),eA=t(79397),eS=t(20508),e_=t(16485),eE=t(73683);let eI={feature:"bg-blue-500/10 text-blue-400 border-blue-500/20",bug:"bg-red-500/10 text-red-400 border-red-500/20",task:"bg-green-500/10 text-green-400 border-green-500/20",spike:"bg-purple-500/10 text-purple-400 border-purple-500/20"};function eP(e){let s,{story:t,currentUserId:h}=e,x=(0,r.useRouter)(),[f,j]=i.useState(t),[N,w]=i.useState(null),[k,C]=i.useState({}),[E,I]=i.useState(!1),[P,T]=i.useState(!1),[R,F]=i.useState([]),[z,D]=i.useState([]),[L,$]=i.useState({total:0,todo:0,inProgress:0,done:0,blocked:0,totalEstimatedHours:0,totalActualHours:0}),Z=i.useCallback(async()=>{try{let e=await v.F.epics.list({projectId:f.projectId,status:"published"});F(e.data||[])}catch(e){console.error("Failed to load epics:",e)}},[f.projectId]);i.useEffect(()=>{f.projectId&&Z()},[f.projectId,Z]),i.useEffect(()=>{U()},[f.id]);let U=async()=>{try{let e=await fetch("/api/stories/".concat(f.id,"/tasks"));if(e.ok){let s=await e.json();D(s.data||[]),$(s.stats||{total:0,todo:0,inProgress:0,done:0,blocked:0,totalEstimatedHours:0,totalActualHours:0})}}catch(e){console.error("Failed to load tasks:",e)}},G=e=>{w(e),C({[e]:f[e]})},V=()=>{w(null),C({})},O=async e=>{if(!k[e])return void V();I(!0);try{let s=await v.F.stories.update(f.id,{[e]:k[e]});j(s),w(null),C({}),p.o.success("Story updated"),x.refresh()}catch(e){p.o.error(e.message||"Failed to update story"),C({})}finally{I(!1)}},B=async(e,s)=>{let t=f[e];j({...f,[e]:s});try{let t=await v.F.stories.update(f.id,{[e]:s});j(t),p.o.success("Story updated"),x.refresh()}catch(s){j({...f,[e]:t}),p.o.error(s.message||"Failed to update story")}};return(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-8 py-8 space-y-6",children:[(0,a.jsx)(l.Zp,{children:(0,a.jsxs)(l.Wu,{className:"pt-6",children:["title"===N?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.p,{value:k.title,onChange:e=>C({...k,title:e.target.value}),className:"text-2xl font-bold",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&O("title"),"Escape"===e.key&&V()}}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.$,{size:"sm",onClick:()=>O("title"),disabled:E,children:[(0,a.jsx)(ek.A,{className:"h-4 w-4 mr-1"}),"Save"]}),(0,a.jsxs)(o.$,{size:"sm",variant:"ghost",onClick:V,children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):(0,a.jsxs)("div",{className:"flex items-start justify-between group",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:f.title}),(0,a.jsxs)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(eb,{storyId:f.id}),(0,a.jsx)(o.$,{size:"sm",variant:"ghost",onClick:()=>G("title"),children:(0,a.jsx)(H.A,{className:"h-4 w-4"})}),(0,a.jsx)(o.$,{size:"sm",variant:"ghost",onClick:()=>{let e="".concat(window.location.origin,"/stories/").concat(f.id);navigator.clipboard.writeText(e),T(!0),p.o.success("Link copied to clipboard"),setTimeout(()=>T(!1),2e3)},children:P?(0,a.jsx)(g.A,{className:"h-4 w-4 text-green-500"}):(0,a.jsx)(eC.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mt-4",children:[(0,a.jsxs)(m.l,{value:f.status,onChange:e=>B("status",e.target.value),children:[(0,a.jsx)("option",{value:"backlog",children:"Backlog"}),(0,a.jsx)("option",{value:"ready",children:"Ready"}),(0,a.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,a.jsx)("option",{value:"review",children:"Review"}),(0,a.jsx)("option",{value:"done",children:"Done"}),(0,a.jsx)("option",{value:"blocked",children:"Blocked"})]}),(0,a.jsxs)(m.l,{value:f.priority,onChange:e=>B("priority",e.target.value),children:[(0,a.jsx)("option",{value:"low",children:"Low"}),(0,a.jsx)("option",{value:"medium",children:"Medium"}),(0,a.jsx)("option",{value:"high",children:"High"}),(0,a.jsx)("option",{value:"critical",children:"Critical"})]}),(0,a.jsx)(n.E,{className:(0,b.cn)("border",eI[f.storyType]),children:f.storyType}),f.storyPoints&&(0,a.jsxs)(n.E,{variant:"outline",children:[f.storyPoints," points"]}),f.aiGenerated&&(0,a.jsx)(n.E,{variant:"secondary",children:"AI Generated"})]})]})}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-lg",children:"Description"})}),(0,a.jsx)(l.Wu,{children:"description"===N?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.T,{value:k.description,onChange:e=>C({...k,description:e.target.value}),rows:6,autoFocus:!0}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.$,{size:"sm",onClick:()=>O("description"),disabled:E,children:[(0,a.jsx)(ek.A,{className:"h-4 w-4 mr-1"}),"Save"]}),(0,a.jsxs)(o.$,{size:"sm",variant:"ghost",onClick:V,children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):(0,a.jsx)("div",{className:"group",children:f.description?(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("p",{className:"text-muted-foreground whitespace-pre-wrap flex-1",children:f.description}),(0,a.jsx)(o.$,{size:"sm",variant:"ghost",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>G("description"),children:(0,a.jsx)(H.A,{className:"h-4 w-4"})})]}):(0,a.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>G("description"),className:"text-muted-foreground",children:"Add description..."})})})]}),(0,a.jsx)(A,{storyId:f.id,acceptanceCriteria:f.acceptanceCriteria||[],onUpdate:e=>j({...f,acceptanceCriteria:e})}),(0,a.jsx)(q,{storyId:f.id,projectId:f.projectId,tasks:z,stats:L,onTasksChange:U}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-lg",children:"Details"})}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[f.project&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eA.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Project"}),(0,a.jsx)(ew(),{href:(s=f.projectId,"/projects/".concat(s)),className:"text-sm font-medium hover:underline text-blue-400",children:f.project.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eA.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Epic"}),(0,a.jsxs)(m.l,{value:f.epicId||"",onChange:e=>B("epicId",e.target.value||null),className:"w-full",children:[(0,a.jsx)("option",{value:"",children:"No Epic"}),R.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eS.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Assigned To"}),(0,a.jsx)(S.o,{value:f.assignedTo,onChange:e=>B("assignedTo",e),placeholder:"Unassigned"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(e_.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Created"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:(0,eE.GP)(new Date(f.createdAt),"PPP")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(e_.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Updated"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:(0,eE.GP)(new Date(f.updatedAt),"PPP")})]})]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-lg",children:"Tags"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)(_.u,{value:f.tags||[],onChange:e=>B("tags",e),placeholder:"Add tags..."})})]})]}),(0,a.jsx)(l.Zp,{children:(0,a.jsx)(l.Wu,{className:"pt-6",children:(0,a.jsx)(u,{storyId:f.id,currentUserId:h})})})]})}},90235:(e,s,t)=>{"use strict";t.d(s,{J:()=>n});var a=t(95155),i=t(12115),r=t(10489),l=t(25016);let n=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.b,{ref:s,className:(0,l.cn)("text-sm font-medium text-gray-200 leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...i})});n.displayName=r.b.displayName}},e=>{e.O(0,[5707,6489,8720,9484,8184,5193,4650,6434,8971,207,2064,814,4141,3298,1733,575,8248,4850,8441,504,7358],()=>e(e.s=18155)),_N_E=e.O()}]);